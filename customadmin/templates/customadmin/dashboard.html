{% extends 'customadmin/base.html' %}
{% load static %}

{% block d-active %}active{% endblock %}

{% block dashboard %}

<div class="row">
    <div class="col-lg-6 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
            <h4 class="card-title">Weekly Orders Chart</h4>
            <canvas id="weekly-orders-chart" class="chartjs-render-monitor"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-6 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
            <h4 class="card-title">Monthly Orders Chart</h4>
            <canvas id="monthly-orders-chart" class="chartjs-render-monitor"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-6 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Yearly Orders Chart</h4>
                <canvas id="yearly-orders-chart" class="chartjs-render-monitor"></canvas>
            </div>
        </div>
      </div>
      <div class="col-lg-6 grid-margin stretch-card">
        <div class="report-container">
            <h2>Sales Report Generator</h2>
            <form id="sales-report-form" method="post" action = "{% url 'generate_sales_report' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="from-date">From Date:</label>
                    <input type="date" id="from-date" name="from_date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="to-date">To Date:</label>
                    <input type="date" id="to-date" name="to_date" class="form-control">
                </div>
                <div class="form-group">
                    <button type="submit" id="generate-report-btn" class="btn btn-primary">Generate Report</button>
                </div>
            </form>
        </div>
        </div>
      </div>
    </div>
  </div>








<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Fetch data from the backend
    fetch('{% url "orders_chart_data" %}')
        .then(response => response.json())
        .then(data => {
            // Weekly Orders Chart
            var weeklyCanvas = document.getElementById('weekly-orders-chart');
            var weeklyCtx = weeklyCanvas.getContext('2d');
            var weeklyConfig = {
                type: 'line',
                data: {
                    labels: Array.from({ length: 52 }, (_, i) => i + 1),
                    datasets: [
                        {
                            label: 'Weekly Orders',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            data: data.weekly_orders,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Weekly Orders Chart',
                        },
                    },
                },
            };
            new Chart(weeklyCtx, weeklyConfig);

            // Monthly Orders Chart
            var monthlyCanvas = document.getElementById('monthly-orders-chart');
            var monthlyCtx = monthlyCanvas.getContext('2d');
            var monthlyConfig = {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Monthly Orders',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1,
                            data: data.monthly_orders,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Monthly Orders Chart',
                        },
                    },
                },
            };
            new Chart(monthlyCtx, monthlyConfig);

            // Yearly Orders Chart
            var yearlyCanvas = document.getElementById('yearly-orders-chart');
            var yearlyCtx = yearlyCanvas.getContext('2d');
            var yearlyConfig = {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.yearly_orders.length }, (_, i) => i + data.yearly_orders_start_year),
                    datasets: [
                        {
                            label: 'Yearly Orders',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            data: data.yearly_orders,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Yearly Orders Chart',
                        },
                    },
                },
            };
            new Chart(yearlyCtx, yearlyConfig);
        })
        .catch(error => {
            console.error('Error fetching chart data:', error);
        });
</script>
{% endblock dashboard %}
